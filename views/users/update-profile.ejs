<style>

    .spread-form {
        background: #000;
        margin-top: 40px;
    }
    .input-section {
        margin-bottom: 5px;
    }
    .input-header {
        text-align: center;
        padding: 5px;
        font-size: 1.2rem;
        font-weight: bold;
    }
    .input-data {
        margin-bottom: 3px;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    .input-data label {
        background: rgba(255, 255, 255, 0.25);
        color: #fff;
        text-align: center;
        width: 20%;
        font-size: 1rem;
        padding: 4px;
    }
    .input-data input {
        background: rgba(135, 206, 250, 0.5);
        width: 80%;
        font-size: 1rem;
        padding: 4px;
        border-top-left-radius: 6px;
        border-bottom-left-radius: 6px;
        outline: none;
        border: inset 2px lightskyblue;
        border-right: none;
        box-shadow: inset 0 0 5px rgba(255, 255, 255, 0.5);
    }
    .dropdown-data {
        color: #fff;
        text-align: center;
    }
    .boolean-data {
        color: #fff;
        text-align: center;
    }

    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 999999; /* Sit on top */
        padding-top: 100px; /* Location of the box */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        backdrop-filter: blur(4px);
        box-shadow: inset 0 0 50px rgba(255, 0, 0, 0.25);
    }
    #openDelModal {
        background: rgba(255, 0, 0, 0.75);
        margin-top: 30px;
        margin-bottom: 60px;
        width: 50%;
        margin-left: 25%;
        outline: none;
        border: outset 2px red;
        border-radius: 6px;
        color: #fff;
        font-size: 1.2rem;
        padding: 5px;
    }
    /* Modal Content */
    .modal-content {
        background-color: rgba(255, 255, 255, 0.5);
        border-radius: 6px;
        margin: auto;
        padding: 10px;
        border: 1px outset rgba(136, 136, 136, 0.75);
        width: 80%;
    }
    .modal-content p {
        padding: 10px;
        font-size: 1.2rem;
        font-weight: bold;
    }

    /* The Close Button */
    .close {
        color: red;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: #000;
        text-decoration: none;
        cursor: pointer;
    }
    #deleteButton {
        background: rgba(255, 0, 0, 0.75);
        border: outset 1px red;
        color: #fff;
        padding: 5px;
        text-align: center;
    }
</style>

<div class="sub-zone-title">
    <h2>
        <%= subZone %>
    </h2>
</div>

<%- include('../partials/menus/user'); %>

<div class="page-header">
    <h4>Update Your Profile</h4>
</div>


<section class="spread-form">
    <form action="/users/update-profile?_method=PATCH" method="post">
        <div class="input-section">
            <div class="input-header">
                <h5>Name</h5>
            </div>
            <div class="input-data">
                <label for="fName">First</label>
                <input type="text" name="fname" id="fName" value="<%= user.fname %>">
            </div>
            
            <div class="input-data">
                <label for="lName">Last</label>
                <input type="text" name="lname" id="lName" value="<%= user.lname %>">
            </div>

        </div>

        <div class="input-section">
            <div class="input-header">
                <h5>Contact</h5>
            </div>

            <div class="input-data">
                <label for="phone1"><i class="fas fa-phone"></i></label>
                <input type="number" name="phone1" id="phone1" value="<%= user.phone1 %>">
            </div>
            <div class="input-data">
                <label for="phone2"><i class="fas fa-phone"></i></label>
                <input type="number" name="phone2" id="phone2" value="<%= user.phone2 %>">
            </div>
            <div class="input-data">
                <label for="email2"><i class="far fa-envelope"></i></label>
                <input type="email" name="email2" id="email2" value="<%= user.email2 %>">
            </div>
        </div>


        <div class="input-section">
            <div class="input-header">
                <h5>Social Media</h5>
            </div>
            <div class="input-data">
                <label for="instagram"><i class="fab fa-instagram"></i></label>
                <input type="text" name="instagram" id="instagram" value="<%= user.social.instagram %>">
            </div>
            <div class="input-data">
                <label for="rumble"><i class="fab fa-ravelry"></i></label>
                <input type="text" name="rumble" id="rumble" value="<%= user.social.rumble %>">
            </div>
            <div class="input-data">
                <label for="discord"><i class="fab fa-discord"></i></label>
                <input type="text" name="discord" id="discord" value="<%= user.social.discord %>">
            </div>
            <div class="input-data">
                <label for="twitter"><i class="fab fa-twitter"></i></label>
                <input type="text" name="twitter" id="twitter" value="<%= user.social.twitter %>">
            </div>
            <div class="input-data">
                <label for="facebook"><i class="fab fa-facebook-f"></i></label>
                <input type="text" name="facebook" id="facebook" value="<%= user.social.facebook %>">
            </div>
            <div class="input-data">
                <label for="linkedin"><i class="fab fa-linkedin-in"></i></label>
                <input type="text" name="linkedin" id="linkedin" value="<%= user.social.linkedin %>">
            </div>
            <div class="input-data">
                <label for="tiktok"><i class="fab fa-tiktok"></i></label>
                <input type="text" name="tiktok" id="tiktok" value="<%= user.social.tiktok %>">
            </div>
            <div class="input-data">
                <label for="foursquare"><i class="fab fa-foursquare"></i></label>
                <input type="text" name="foursquare" id="foursquare" value="<%= user.social.foursquare %>">
            </div>
            <div class="input-data">
                <label for="google_plus"><i class="fab fa-google-plus-g"></i></label>
                <input type="text" name="google_plus" id="google_plus" value="<%= user.social.google_plus %>">
            </div>
            <div class="input-data">
                <label for="pinterest"><i class="fab fa-pinterest-p"></i></label>
                <input type="text" name="pinterest" id="pinterest" value="<%= user.social.pinterest %>">
            </div>
            <div class="input-data">
                <label for="snapchat"><i class="fab fa-snapchat-ghost"></i></label>
                <input type="text" name="snapchat" id="snapchat" value="<%= user.social.snapchat %>">
            </div>
            <div class="input-data">
                <label for="reddit"><i class="fab fa-reddit-alien"></i></label>
                <input type="text" name="reddit" id="reddit" value="<%= user.social.reddit %>">
            </div>
            <div class="input-data">
                <label for="slack"><i class="fab fa-slack-hash"></i></label>
                <input type="text" name="slack" id="slack" value="<%= user.social.slack %>">
            </div>
            <div class="input-data">
                <label for="twitch"><i class="fab fa-twitch"></i></label>
                <input type="text" name="twitch" id="twitch" value="<%= user.social.twitch %>">
            </div>
            <div class="input-data">
                <label for="whatsapp"><i class="fab fa-whatsapp"></i></label>
                <input type="text" name="whatsapp" id="whatsapp" value="<%= user.social.whatsapp %>">
            </div>
            <div class="input-data">
                <label for="telegram"><i class="fab fa-telegram-plane"></i></label>
                <input type="text" name="telegram" id="telegram" value="<%= user.social.telegram %>">
            </div>
            <div class="input-data">
                <label for="youtube"><i class="fab fa-youtube"></i></label>
                <input type="text" name="youtube" id="youtube" value="<%= user.social.youtube %>">
            </div>
        </div>

        <div class="input-section">
            <div class="input-header">
                <h5>Developers</h5>
            </div>
            <div class="input-data">
                <label for="codepen"><i class="fab fa-codepen"></i></label>
                <input type="text" name="codepen" id="codepen" value="<%= user.social.codepen %>">
            </div>
            <div class="input-data">
                <label for="github"><i class="fab fa-github-alt"></i></label>
                <input type="text" name="github" id="github" value="<%= user.social.github %>">
            </div>
            <div class="input-data">
                <label for="kickstarter"><i class="fab fa-kickstarter-k"></i></label>
                <input type="text" name="kickstarter" id="kickstarter" value="<%= user.social.kickstarter %>">
            </div>
            <div class="input-data">
                <label for="stackOverflow"><i class="fab fa-stack-overflow"></i></label>
                <input type="text" name="stack_overflow" id="stackOverflow" value="<%= user.social.stack_overflow %>">
            </div>
            <div class="input-data">
                <label for="figma"><i class="fab fa-figma"></i></label>
                <input type="text" name="figma" id="figma" value="<%= user.social.figma %>">
            </div>
            <div class="input-data">
                <label for="dribble"><i class="fab fa-dribbble"></i></label>
                <input type="text" name="dribble" id="dribble" value="<%= user.social.dribble %>">
            </div>
        </div>
        
        <div class="input-section">
            <div class="input-header">
                <h5>Gaming</h5>
            </div>
            <div class="input-data">
                <label for="playstation"><i class="fab fa-playstation"></i></label>
                <input type="text" name="playstation" id="playstation"  value="<%= user.social.playstation %>">
            </div>
            <div class="input-data">
                <label for="xbox"><i class="fab fa-xbox"></i></label>
                <input type="text" name="xbox" id="xbox" value="<%= user.social.xbox %>">
            </div>
        </div>

        <div class="input-section">
            <div class="input-header">
                <h5>Financial</h5>
            </div>
            <div class="input-data">
                <label for="paypal"><i class="fab fa-paypal"></i></label>
                <input type="text" name="paypal" id="paypal" value="<%= user.paypal %>">
            </div>
            <div class="input-data">
                <label for="patreon"><i class="fab fa-patreon"></i></label>
                <input type="text" name="patreon" id="patreon" value="<%= user.patreon %>">
            </div>
        </div>

        <div class="input-section address-inputs">
            <div class="input-header">
                <h5>Shipping Address</h5>
            </div>
            <div class="input-data">
                <label for="street1">Street 1</label>
                <input type="text" name="street1" id="street1" value="<%= user.street1 %>">
            </div>
            <div class="input-data">
                <label for="street2">Street 2</label>
                <input type="text" name="street2" id="street2" value="<%= user.street2 %>">
            </div>
            <div class="input-data">
                <label for="city">City</label>
                <input type="text" name="city" id="city" value="<%= user.city %>">
            </div>
            <div class="input-data-select">
                <span id="userLivesInState" style="display: none;"><%= user.state %></span>
                <label>State</label>
                <select data-custom>
                    <option value="AL">Alabama</option>
                    <option value="AK">Alaska</option>
                    <option value="AZ">Arizona</option>
                    <option value="AR">Arkansas</option>
                    <option value="CA">California</option>
                    <option value="CO">Colorado</option>
                    <option value="CT">Connecticut</option>
                    <option value="DE">Delaware</option>
                    <option value="DC">District Of Columbia</option>
                    <option value="FL">Florida</option>
                    <option value="GA">Georgia</option>
                    <option value="HI">Hawaii</option>
                    <option value="ID">Idaho</option>
                    <option value="IL">Illinois</option>
                    <option value="IN">Indiana</option>
                    <option value="IA">Iowa</option>
                    <option value="KS">Kansas</option>
                    <option value="KY">Kentucky</option>
                    <option value="LA">Louisiana</option>
                    <option value="ME">Maine</option>
                    <option value="MD">Maryland</option>
                    <option value="MA">Massachusetts</option>
                    <option value="MI">Michigan</option>
                    <option value="MN">Minnesota</option>
                    <option value="MS">Mississippi</option>
                    <option value="MO">Missouri</option>
                    <option value="MT">Montana</option>
                    <option value="NE">Nebraska</option>
                    <option value="NV">Nevada</option>
                    <option value="NH">New Hampshire</option>
                    <option value="NJ">New Jersey</option>
                    <option value="NM">New Mexico</option>
                    <option value="NY">New York</option>
                    <option value="NC">North Carolina</option>
                    <option value="ND">North Dakota</option>
                    <option value="OH">Ohio</option>
                    <option value="OK">Oklahoma</option>
                    <option value="OR">Oregon</option>
                    <option value="PA">Pennsylvania</option>
                    <option value="RI">Rhode Island</option>
                    <option value="SC">South Carolina</option>
                    <option value="SD">South Dakota</option>
                    <option value="TN">Tennessee</option>
                    <option value="TX">Texas</option>
                    <option value="UT">Utah</option>
                    <option value="VT">Vermont</option>
                    <option value="VA">Virginia</option>
                    <option value="WA">Washington</option>
                    <option value="WV">West Virginia</option>
                    <option value="WI">Wisconsin</option>
                    <option value="WY">Wyoming</option>
                </select>
            </div>
            <div class="input-data">
                <label for="zip">Zip</label>
                <input type="text" name="zip" id="zip" value="<%= user.zip %>">
            </div>
            <div class="input-data">
                <label for="country">Country</label>
                <input type="text" name="country" id="country" value="<%= user.country %>">
            </div>
        </div>
        <div class="input-section">
            <div class="input-header">
                <h5>Color Scheme</h5>
            </div>
            <div class="input-container">
                <div class="input-data">
                    <label for="favColor1">Main</label>
                    <input type="color" name="favColor1" id="favColor1" value="<%= user.favColor1 %>">
                </div>
                <div class="input-data">
                    <label for="favColor2">Accent</label>
                    <input type="color" name="favColor2" id="favColor2" value="<%= user.favColor2 %>">
                </div>
            </div>
        </div>

        <div class="input-section">
            <div class="input-header">
                <h5>Preferences</h5>
            </div>
            <div class="dropdown-data">
                <label for="measuring_system">Measuring System</label>
                <select name="measuring_system" id="measuring_system">
                    <option value="imperial" selected>Imperial</option>
                    <option value="metric">Metric</option>
                </select>
            </div>
            <div class="boolean-data">
                <label for="wants_hints">Hints</label>
                <input type="checkbox" name="wants_hints" id="wants_hints" checked>
            </div>
            <button type="submit">Update Profile</button>    
        </div>
    </form>
    <button id="openDelModal">Delete Account</button>
    <!-- Double Check Delete Account Modal -->
    <div id="deleteModal" class="modal">
        
        <!-- Modal Content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <p>Are you sure you want delete your account?</p>
            <p>All your data will be lost.</p>
            <form action="/users/delete?_method=DELETE" method="post">
                <button type="submit" id="deleteButton" onclick="doubleCheck()">Delete Account</button>
            </form>
        </div>
    
    </div>
</section>



<script>
    const modal = document.getElementById("deleteModal");
    const btn = document.getElementById("openDelModal");
    const span = document.getElementsByClassName("close")[0];

    btn.onclick = function() {
        modal.style.display = "block";
    }

    span.onclick = function() {
        modal.style.display = "none";
    }   

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }
</script>

<script>

 class Select {
        constructor(element) {
            this.element = element
            this.options = getFormattedOptions(element.querySelectorAll("option"))
            this.customElement = document.createElement("div")
            this.labelElement = document.createElement("span")
            this.optionsCustomElement = document.createElement("ul")
            setupCustomElement(this)
            element.style.display = "none"
            element.after(this.customElement)
        }
        
        get selectedOption() {
            return this.options.find(option => option.selected)
        }

        get selectedOptionIndex() {
            return this.options.indexOf(this.selectedOption)
        }

        selectValue(value) {
            
            const newSelectedOption = this.options.find(option => {
                return option.value === value
            })
            const prevSelectedOption = this.selectedOption
            prevSelectedOption.selected = false
            prevSelectedOption.element.selected = false

            newSelectedOption.selected = true
            newSelectedOption.element.selected = true

            this.labelElement.innerText = newSelectedOption.label
            this.optionsCustomElement
                .querySelector(`[data-value="${prevSelectedOption.value}"]`)
                .classList.remove("selected")
            const newCustomElement = this.optionsCustomElement.querySelector(
                `[data-value="${newSelectedOption.value}"]`
            )
            newCustomElement.classList.add("selected")
            newCustomElement.scrollIntoView({ block: "nearest" })
        }
    }

    function setupCustomElement(select) {
        select.customElement.classList.add("custom-select-container")
        select.customElement.tabIndex = 0

        select.labelElement.classList.add("custom-select-value")

        const userSavedState = document.querySelector('#userLivesInState').innerText
            if (userSavedState != 'null') {
                select.labelElement.innerText = userSavedState
            } else {
                select.labelElement.innerText = select.selectedOption.label
            }
        select.customElement.append(select.labelElement)


        select.optionsCustomElement.classList.add("custom-select-options")
        select.options.forEach(option => {
            const optionElement = document.createElement("li")
            optionElement.classList.add("custom-select-option")
            optionElement.classList.toggle("selected", option.selected)
            optionElement.innerText = option.label
            optionElement.dataset.value = option.value
            optionElement.addEventListener("click", () => {
                select.selectValue(option.value)
                select.optionsCustomElement.classList.remove("show")
            })
            select.optionsCustomElement.append(optionElement)
        })
        select.customElement.append(select.optionsCustomElement)

        select.labelElement.addEventListener("click", () => {
            select.optionsCustomElement.classList.toggle("show")
        })

        select.customElement.addEventListener("blur", () => {
            select.optionsCustomElement.classList.remove("show")
        })

        let debounceTimeout
        let searchTerm = ""
        select.customElement.addEventListener("keydown", e => {
            switch (e.code) {
                case "Space":
                    select.optionsCustomElement.classList.toggle("show")
                    break
                case "ArrowUp": {
                    const prevOption = select.options[select.selectedOptionIndex - 1]
                    if (prevOption) {
                        select.selectValue(prevOption.value)
                    }
                    break
                }
                case "ArrowDown": {
                    const nextOption = select.options[select.selectedOptionIndex + 1]
                    if (nextOption) {
                        select.selectValue(nextOption.value)
                    }
                    break
                }
                case "Enter":
                case "Escape":
                    select.optionsCustomElement.classList.remove("show")
                    break
                default: {
                    clearTimeout(debounceTimeout)
                    searchTerm += e.key
                    debounceTimeout = setTimeout(() => {
                        searchTerm = ""
                    }, 500)

                    const searchedOption = select.options.find(option => {
                        return option.label.toLowerCase().startsWith(searchTerm)
                    })
                    if (searchedOption) {
                        select.selectValue(searchedOption.value)
                    }
                }
            }
        })
    }

    function getFormattedOptions(optionElements) {
        return [...optionElements].map(optionElement => {
            return {
                value: optionElement.value,
                label: optionElement.label,
                selected: optionElement.selected,
                element: optionElement,
            }
        })
    }

    const selectElements = document.querySelectorAll("[data-custom]")

        selectElements.forEach(selectElement => {
            new Select(selectElement)
        })
</script>